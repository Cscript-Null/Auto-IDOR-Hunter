# 自动化越权漏洞检测系统

## 目录
- [简介](#简介)
- [系统架构](#系统架构)
- [核心组件](#核心组件)
  - [代理服务器](#代理服务器)
  - [数据库](#数据库)
  - [FastAPI 后端](#fastapi-后端)
  - [JavaScript 分析模块](#javascript-分析模块)
  - [Cookie 管理](#cookie-管理)
  - [漏洞检测模块](#漏洞检测模块)
- [工作流程](#工作流程)
- [系统优势](#系统优势)
- [总结](#总结)

---

## 简介

在现代Web应用中，API的安全性至关重要，尤其是防范越权漏洞（Privilege Escation Vulnerabilities）。越权漏洞允许攻击者通过操纵请求，访问或修改本不应有权限的数据或操作。为此，我们开发了一套自动化的越权漏洞检测系统，利用自定义代理服务器、智能分析工具和自动化检测流程，帮助开发者和安全人员高效地发现并修复潜在的安全漏洞。

## 系统架构

系统整体架构由以下几个主要部分组成：

1. **代理服务器**：拦截和分析浏览器的HTTP/HTTPS流量，捕获潜在的越权请求和JavaScript文件。
2. **数据库**：存储拦截到的模式、Cookie凭据、匹配记录、响应历史、JavaScript文件及其提取的API请求。
3. **FastAPI 后端**：提供用户界面和API接口，用于管理配置、查看结果和控制系统运行。
4. **JavaScript 分析模块**：解析拦截到的JavaScript文件，提取API请求信息。
5. **漏洞检测模块**：自动化发送替换后的请求，分析响应以检测越权漏洞。
6. **用户界面**：通过Web界面允许用户管理Cookie、查看检测结果和控制代理服务器。

## 核心组件

### 代理服务器

**功能**：
- 拦截用户浏览器的所有HTTP/HTTPS请求和响应。
- 分析和保存可能存在越权漏洞的数据包。
- 截获并解析JavaScript文件，以提取其中的API请求。

**实现**：
- 使用自定义的`ProxyServer`类，通过Socket和SSL实现通信拦截。
- 利用正则表达式和AST（抽象语法树）分析技术，识别并提取潜在的API请求。

### 数据库

**功能**：
- 保存和管理系统运行过程中生成的各种数据，包括模式、Cookie凭据、匹配记录、响应历史、JavaScript文件及其API请求。

**主要表结构**：
- `Pattern`: 存储识别模式。
- `CookieCredential`: 管理用户的Cookie凭据。
- `ProcessedMatch`: 记录匹配到的潜在越权请求。
- `ResponseHistory`: 存储每次请求的响应数据。
- `JSFile`: 保存截获的JavaScript文件。
- `APIRequest`: 记录从JavaScript文件中提取的API请求。

### FastAPI 后端

**功能**：
- 提供Web界面和API接口，允许用户查看和管理系统配置、Cookie、匹配记录和检测结果。
- 控制代理服务器的启动、重启和停止。
- 处理前端请求，执行相应的数据库操作和业务逻辑。

**主要功能模块**：
- **主页与基础配置**：展示系统主页，允许用户进行基本配置。
- **模式管理**：查看、添加、编辑和删除识别模式。
- **Cookie管理**：管理用户提供的Cookie凭据。
- **匹配记录管理**：查看、编辑和删除拦截到的匹配记录。
- **漏洞检测控制**：启动、重启和停止代理服务器，管理检测任务。
- **JavaScript文件处理**：展示和提取截获的JavaScript文件中的API请求。

### JavaScript 分析模块

**功能**：
- 解析截获的JavaScript文件，提取其中的API请求。
- 通过AST分析定位关键的API调用函数，如`fetch`和`xhr.send`。

**实现**：
- 使用AST解析库（如Esprima或Acorn）解析JavaScript代码，识别并提取API请求的类型、URL、方法、头信息和请求体等。
- 通过正则表达式进一步过滤和精炼提取的信息。

### Cookie 管理

**功能**：
- 允许用户输入和管理不同的Cookie凭据。
- 在检测过程中，替换拦截到的请求中的Cookie，以模拟不同用户的权限级别。

**实现**：
- 提供Web界面，允许用户添加、编辑和删除Cookie凭据。
- 在发送请求之前，通过FastAPI后端将用户提供的Cookie替换到请求中。

### 漏洞检测模块

**功能**：
- 使用用户提供的Cookie，自动发送替换后的请求到提取的API端点。
- 捕获并存储每次请求的响应数据。
- 分析响应数据，使用人工智能模型和JSON相似性比较，检测是否存在越权漏洞。

**实现**：
- 后端通过Socket或HTTP库发送替换后的请求，捕获响应数据。
- 使用AI模型（如OpenAI）进行响应分析，识别权限升级的迹象。
- 比较不同响应的JSON结构和内容，判断是否存在异常或不一致。

## 工作流程

1. **代理配置**：
   - 用户将浏览器的代理服务器设置为我们的自定义代理服务器，以便拦截所有流量。

2. **流量拦截**：
   - 代理服务器拦截并分析所有通过的HTTP/HTTPS请求和响应，识别潜在的越权API请求并保存到数据库。

3. **JavaScript文件拦截与解析**：
   - 代理服务器截获响应中的JavaScript文件，传递给JavaScript分析模块，通过AST和正则表达式提取API请求。

4. **用户输入Cookie**：
   - 用户通过Web界面输入不同的Cookie凭据，系统将这些Cookie存储并用于后续的请求替换。

5. **请求重放与Cookie替换**：
   - 系统自动将拦截到的请求中的Cookie替换为用户提供的不同Cookie，向提取的API发送修改后的请求。

6. **响应捕获与存储**：
   - 捕获每次请求的响应数据，并将其保存到数据库中的`ResponseHistory`表。

7. **漏洞检测**：
   - 使用人工智能模型分析响应数据，或通过JSON结构和内容的相似性比较，判断是否存在越权漏洞。
   - 更新数据库中的`ProcessedMatch`记录，标记检测结果和原因。

8. **结果展示**：
   - 用户通过Web界面查看检测结果，了解哪些API存在潜在的越权漏洞，并获取详细的检测原因。

## 系统优势

- **自动化检测**：全面自动化的检测流程，减少人工干预，提高检测效率和准确性。
- **多重分析手段**：结合人工智能模型和结构化的数据比较，提供多层次的漏洞检测，降低误报和漏报率。
- **用户友好**：通过简洁的Web界面，用户可以轻松管理Cookie凭据、配置检测参数、查看和管理检测结果。
- **可扩展性强**：系统架构模块化，易于扩展和集成更多的分析和检测功能。
- **实时性高**：代理服务器实时拦截和处理流量，确保及时检测最新的漏洞。
- **安全性保障**：通过严格的权限管理和数据隔离，确保用户数据和检测结果的安全。
- **可追溯性**：详尽的日志和历史记录，便于追溯和审计系统的检测过程。

## 总结

本自动化越权漏洞检测系统通过自定义代理服务器拦截和分析浏览器流量，结合先进的JavaScript解析和智能漏洞检测技术，提供了一套高效、全面的API安全检测解决方案。系统不仅提升了漏洞检测的自动化水平，还通过多重分析手段和用户友好的界面，增强了用户体验和检测的精准度。未来，系统还可进一步集成更多智能分析模块和扩展检测覆盖范围，以应对不断演进的Web安全威胁。

# Quick Start

1. **安装依赖**：
    ```bash
    pip install -r requirements.txt
    ```

2. **启动数据库**：
    - 配置并启动支持的数据库（如 PostgreSQL、SQLite 等）。

3. **运行应用**：
    ```bash
    uvicorn app.main:app --reload
    ```

4. **配置浏览器代理**：
    - 将浏览器的代理服务器设置为系统代理服务器的地址和端口。

5. **访问Web界面**：
    - 打开浏览器访问 `http://localhost:8000`，按照界面提示进行操作。

# 联系我们

如有任何问题或建议，欢迎通过 [联系我们](mailto:your.email@example.com) 与我们取得联系。

---

# 自动化越权漏洞检测系统

## 简介

在现代Web应用中，API（应用程序编程接口）的安全性至关重要。越权漏洞（Privilege Escalation Vulnerabilities）指的是攻击者通过操纵请求，访问或修改本不应有权限的数据或操作。本系统旨在自动化检测这类漏洞，通过拦截和分析用户浏览器与服务器之间的流量，识别并报告潜在的安全隐患。

## 系统架构

系统架构主要由以下几个部分组成：

1. **代理服务器**：拦截和分析通过浏览器的HTTP/HTTPS请求和响应，捕获潜在的越权请求和JavaScript文件。
2. **数据库**：存储拦截到的各种数据，包括识别模式、Cookie凭据、匹配记录、响应历史、JavaScript文件以及提取的API请求。
3. **FastAPI 后端**：提供用户界面和API接口，用于管理配置、查看结果和控制系统运行。
4. **JavaScript 分析模块**：解析拦截到的JavaScript文件，提取其中的API请求信息。
5. **漏洞检测模块**：自动发送替换后的请求，分析响应以检测越权漏洞。
6. **用户界面**：通过Web界面允许用户管理Cookie、查看检测结果和控制代理服务器。

![系统架构图](path/to/your/architecture-diagram.png)

## 核心组件

### 代理服务器

**功能**：
- 拦截用户浏览器的所有HTTP/HTTPS请求和响应。
- 分析并保存可能存在越权漏洞的数据包。
- 截获并解析JavaScript文件，以提取其中的API请求。

**实现**：
- 自定义的`ProxyServer`类，通过Socket和SSL实现通信拦截。
- 使用正则表达式和AST（抽象语法树）分析技术，识别并提取潜在的API请求。

### 数据库

**功能**：
- 保存和管理系统运行过程中生成的各种数据，包括模式、Cookie凭据、匹配记录、响应历史、JavaScript文件及其API请求。

**主要表结构**：
- `Pattern`: 存储识别模式。
- `CookieCredential`: 管理用户的Cookie凭据。
- `ProcessedMatch`: 记录匹配到的潜在越权请求。
- `ResponseHistory`: 存储每次请求的响应数据。
- `JSFile`: 保存截获的JavaScript文件。
- `APIRequest`: 记录从JavaScript文件中提取的API请求。

### FastAPI 后端

**功能**：
- 提供Web界面和API接口，允许用户查看和管理系统配置、Cookie、匹配记录和检测结果。
- 控制代理服务器的启动、重启和停止。
- 处理前端请求，执行相应的数据库操作和业务逻辑。

**主要功能模块**：
- **主页与基础配置**：展示系统主页，允许用户进行基本配置。
- **模式管理**：查看、添加、编辑和删除识别模式。
- **Cookie管理**：管理用户提供的Cookie凭据。
- **匹配记录管理**：查看、编辑和删除拦截到的匹配记录。
- **漏洞检测控制**：启动、重启和停止代理服务器，管理检测任务。
- **JavaScript文件处理**：展示和提取截获的JavaScript文件中的API请求。

### JavaScript 分析模块

**功能**：
- 解析截获的JavaScript文件，提取其中的API请求。
- 通过AST分析定位关键的API调用函数，如`fetch`和`xhr.send`。

**实现**：
- 使用AST解析库（如Esprima或Acorn）解析JavaScript代码，识别并提取API请求的类型、URL、方法、头信息和请求体等。
- 使用正则表达式进一步过滤和精炼提取的信息。

### Cookie 管理

**功能**：
- 允许用户输入和管理不同的Cookie凭据。
- 在检测过程中，替换拦截到的请求中的Cookie，以模拟不同用户的权限级别。

**实现**：
- 提供Web界面，允许用户添加、编辑和删除Cookie凭据。
- 在发送请求之前，通过FastAPI后端将用户提供的Cookie替换到请求中。

### 漏洞检测模块

**功能**：
- 使用用户提供的Cookie，自动发送替换后的请求到提取的API端点。
- 捕获并存储每次请求的响应数据。
- 分析响应数据，使用人工智能模型和JSON相似性比较，检测是否存在越权漏洞。

**实现**：
- 后端通过Socket或HTTP库发送替换后的请求，捕获响应数据。
- 使用AI模型（如OpenAI）进行响应分析，识别权限升级的迹象。
- 比较不同响应的JSON结构和内容，判断是否存在异常或不一致。

## 工作流程

1. **代理配置**：
   - 用户将浏览器的代理服务器设置为系统提供的自定义代理服务器，以便拦截所有流量。

2. **流量拦截**：
   - 代理服务器拦截并分析所有通过的HTTP/HTTPS请求和响应，识别潜在的越权API请求并保存到数据库。

3. **JavaScript文件拦截与解析**：
   - 代理服务器截获响应中的JavaScript文件，传递给JavaScript分析模块，通过AST和正则表达式提取API请求。

4. **用户输入Cookie**：
   - 用户通过Web界面输入不同的Cookie凭据，系统将这些Cookie存储并用于后续的请求替换。

5. **请求重放与Cookie替换**：
   - 系统自动将拦截到的请求中的Cookie替换为用户提供的不同Cookie，向提取的API发送修改后的请求。

6. **响应捕获与存储**：
   - 捕获每次请求的响应数据，并将其保存到数据库中的`ResponseHistory`表。

7. **漏洞检测**：
   - 使用人工智能模型分析响应数据，或通过JSON结构和内容的相似性比较，判断是否存在越权漏洞。
   - 更新数据库中的`ProcessedMatch`记录，标记检测结果和原因。

8. **结果展示**：
   - 用户通过Web界面查看检测结果，了解哪些API存在潜在的越权漏洞，并获取详细的检测原因。

## 系统优势

- **自动化检测**：全面自动化的检测流程，减少人工干预，提高检测效率和准确性。
- **多重分析手段**：结合人工智能模型和结构化的数据比较，提供多层次的漏洞检测，降低误报和漏报率。
- **用户友好**：通过简洁的Web界面，用户可以轻松管理Cookie凭据、配置检测参数、查看和管理检测结果。
- **可扩展性强**：系统架构模块化，易于扩展和集成更多的分析和检测功能。
- **实时性高**：代理服务器实时拦截和处理流量，确保及时检测最新的漏洞。
- **安全性保障**：通过严格的权限管理和数据隔离，确保用户数据和检测结果的安全。
- **可追溯性**：详尽的日志和历史记录，便于追溯和审计系统的检测过程。

## 总结

本自动化越权漏洞检测系统通过自定义代理服务器拦截和分析浏览器流量，结合先进的JavaScript解析和智能漏洞检测技术，提供了一套高效、全面的API安全检测解决方案。系统不仅提升了漏洞检测的自动化水平，还通过多重分析手段和用户友好的界面，增强了用户体验和检测的精准度。未来，系统还可进一步集成更多智能分析模块和扩展检测覆盖范围，以应对不断演进的Web安全威胁。

## 快速开始

1. **安装依赖**：
    ```bash
    pip install -r requirements.txt
    ```

2. **启动数据库**：
    - 配置并启动支持的数据库（如 PostgreSQL、SQLite 等）。

3. **运行应用**：
    ```bash
    uvicorn app.main:app --reload
    ```

4. **配置浏览器代理**：
    - 将浏览器的代理服务器设置为系统代理服务器的地址和端口。

5. **访问Web界面**：
    - 打开浏览器访问 `http://localhost:8000`，按照界面提示进行操作。

## 联系我们

如有任何问题或建议，欢迎通过 [联系我们](mailto:your.email@example.com) 与我们取得联系。

---

# 自动化越权漏洞检测系统

## 简介

在现代Web应用中，API（应用程序编程接口）的安全性至关重要。越权漏洞（Privilege Escalation Vulnerabilities）指的是攻击者通过操纵请求，访问或修改本不应有权限的数据或操作。本系统旨在自动化检测这类漏洞，通过拦截和分析用户浏览器与服务器之间的流量，识别并报告潜在的安全隐患。

## 系统架构

系统架构主要由以下几个部分组成：

1. **代理服务器**：拦截和分析通过浏览器的HTTP/HTTPS请求和响应，捕获潜在的越权请求和JavaScript文件。
2. **数据库**：存储拦截到的各种数据，包括识别模式、Cookie凭据、匹配记录、响应历史、JavaScript文件以及提取的API请求。
3. **FastAPI 后端**：提供用户界面和API接口，用于管理配置、查看结果和控制系统运行。
4. **JavaScript 分析模块**：解析拦截到的JavaScript文件，提取其中的API请求信息。
5. **漏洞检测模块**：自动发送替换后的请求，分析响应以检测越权漏洞。
6. **用户界面**：通过Web界面允许用户管理Cookie、查看检测结果和控制代理服务器。

![系统架构图](path/to/your/architecture-diagram.png)

## 核心组件

### 代理服务器

**功能**：
- 拦截用户浏览器的所有HTTP/HTTPS请求和响应。
- 分析并保存可能存在越权漏洞的数据包。
- 截获并解析JavaScript文件，以提取其中的API请求。

**实现**：
- 自定义的`ProxyServer`类，通过Socket和SSL实现通信拦截。
- 使用正则表达式和AST（抽象语法树）分析技术，识别并提取潜在的API请求。

### 数据库

**功能**：
- 保存和管理系统运行过程中生成的各种数据，包括模式、Cookie凭据、匹配记录、响应历史、JavaScript文件及其API请求。

**主要表结构**：
- `Pattern`: 存储识别模式。
- `CookieCredential`: 管理用户的Cookie凭据。
- `ProcessedMatch`: 记录匹配到的潜在越权请求。
- `ResponseHistory`: 存储每次请求的响应数据。
- `JSFile`: 保存截获的JavaScript文件。
- `APIRequest`: 记录从JavaScript文件中提取的API请求。

### FastAPI 后端

**功能**：
- 提供Web界面和API接口，允许用户查看和管理系统配置、Cookie、匹配记录和检测结果。
- 控制代理服务器的启动、重启和停止。
- 处理前端请求，执行相应的数据库操作和业务逻辑。

**主要功能模块**：
- **主页与基础配置**：展示系统主页，允许用户进行基本配置。
- **模式管理**：查看、添加、编辑和删除识别模式。
- **Cookie管理**：管理用户提供的Cookie凭据。
- **匹配记录管理**：查看、编辑和删除拦截到的匹配记录。
- **漏洞检测控制**：启动、重启和停止代理服务器，管理检测任务。
- **JavaScript文件处理**：展示和提取截获的JavaScript文件中的API请求。

### JavaScript 分析模块

**功能**：
- 解析截获的JavaScript文件，提取其中的API请求。
- 通过AST分析定位关键的API调用函数，如`fetch`和`xhr.send`。

**实现**：
- 使用AST解析库（如Esprima或Acorn）解析JavaScript代码，识别并提取API请求的类型、URL、方法、头信息和请求体等。
- 使用正则表达式进一步过滤和精炼提取的信息。

### Cookie 管理

**功能**：
- 允许用户输入和管理不同的Cookie凭据。
- 在检测过程中，替换拦截到的请求中的Cookie，以模拟不同用户的权限级别。

**实现**：
- 提供Web界面，允许用户添加、编辑和删除Cookie凭据。
- 在发送请求之前，通过FastAPI后端将用户提供的Cookie替换到请求中。

### 漏洞检测模块

**功能**：
- 使用用户提供的Cookie，自动发送替换后的请求到提取的API端点。
- 捕获并存储每次请求的响应数据。
- 分析响应数据，使用人工智能模型和JSON相似性比较，检测是否存在越权漏洞。

**实现**：
- 后端通过Socket或HTTP库发送替换后的请求，捕获响应数据。
- 使用AI模型（如OpenAI）进行响应分析，识别权限升级的迹象。
- 比较不同响应的JSON结构和内容，判断是否存在异常或不一致。

## 工作流程

1. **代理配置**：
   - 用户将浏览器的代理服务器设置为系统提供的自定义代理服务器，以便拦截所有流量。

2. **流量拦截**：
   - 代理服务器拦截并分析所有通过的HTTP/HTTPS请求和响应，识别潜在的越权API请求并保存到数据库。

3. **JavaScript文件拦截与解析**：
   - 代理服务器截获响应中的JavaScript文件，传递给JavaScript分析模块，通过AST和正则表达式提取API请求。

4. **用户输入Cookie**：
   - 用户通过Web界面输入不同的Cookie凭据，系统将这些Cookie存储并用于后续的请求替换。

5. **请求重放与Cookie替换**：
   - 系统自动将拦截到的请求中的Cookie替换为用户提供的不同Cookie，向提取的API发送修改后的请求。

6. **响应捕获与存储**：
   - 捕获每次请求的响应数据，并将其保存到数据库中的`ResponseHistory`表。

7. **漏洞检测**：
   - 使用人工智能模型分析响应数据，或通过JSON结构和内容的相似性比较，判断是否存在越权漏洞。
   - 更新数据库中的`ProcessedMatch`记录，标记检测结果和原因。

8. **结果展示**：
   - 用户通过Web界面查看检测结果，了解哪些API存在潜在的越权漏洞，并获取详细的检测原因。

## 系统优势

- **自动化检测**：全面自动化的检测流程，减少人工干预，提高检测效率和准确性。
- **多重分析手段**：结合人工智能模型和结构化的数据比较，提供多层次的漏洞检测，降低误报和漏报率。
- **用户友好**：通过简洁的Web界面，用户可以轻松管理Cookie凭据、配置检测参数、查看和管理检测结果。
- **可扩展性强**：系统架构模块化，易于扩展和集成更多的分析和检测功能。
- **实时性高**：代理服务器实时拦截和处理流量，确保及时检测最新的漏洞。
- **安全性保障**：通过严格的权限管理和数据隔离，确保用户数据和检测结果的安全。
- **可追溯性**：详尽的日志和历史记录，便于追溯和审计系统的检测过程。

## 总结

本自动化越权漏洞检测系统通过自定义代理服务器拦截和分析浏览器流量，结合先进的JavaScript解析和智能漏洞检测技术，提供了一套高效、全面的API安全检测解决方案。系统不仅提升了漏洞检测的自动化水平，还通过多重分析手段和用户友好的界面，增强了用户体验和检测的精准度。未来，系统还可进一步集成更多智能分析模块和扩展检测覆盖范围，以应对不断演进的Web安全威胁。

## 快速开始

1. **安装依赖**：

    ```bash
    pip install -r requirements.txt
    ```

2. **启动数据库**：
    - 配置并启动支持的数据库（如 PostgreSQL、SQLite 等）。

3. **运行应用**：

    ```bash
    uvicorn app.main:app --reload
    ```

4. **配置浏览器代理**：
    - 将浏览器的代理服务器设置为系统代理服务器的地址和端口。

5. **访问Web界面**：
    - 打开浏览器访问 `http://localhost:8000`，按照界面提示进行操作。

## 联系我们

如有任何问题或建议，欢迎通过 [联系我们](mailto:your.email@example.com) 与我们取得联系。